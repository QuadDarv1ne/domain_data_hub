-- *******************************************************
-- СКРИПТ СОЗДАНИЯ БАЗЫ ДАННЫХ ДЛЯ ГОСТИНИЦЫ
-- *******************************************************
CREATE DATABASE IF NOT EXISTS hotel;
USE hotel;

-- *******************************************************
-- Таблица для хранения информации о гостях
-- *******************************************************
CREATE TABLE IF NOT EXISTS Guests (
    guest_id INT AUTO_INCREMENT PRIMARY KEY,         -- Уникальный идентификатор гостя
    name VARCHAR(100) NOT NULL,                      -- Имя гостя
    surname VARCHAR(100) NOT NULL,                   -- Фамилия гостя
    patronymic VARCHAR(100),                         -- Отчество гостя (необязательное поле)
    phone VARCHAR(20) NOT NULL,                      -- Номер телефона
    email VARCHAR(100) NOT NULL UNIQUE,              -- Электронная почта
    address TEXT NOT NULL,                           -- Адрес гостя
    passport_no VARCHAR(50) NOT NULL                 -- Номер паспорта
);

-- *******************************************************
-- Таблица для хранения информации о номерах гостиницы
-- *******************************************************
CREATE TABLE IF NOT EXISTS Rooms (
    room_id INT AUTO_INCREMENT PRIMARY KEY,         -- Уникальный идентификатор номера
    room_number VARCHAR(10) NOT NULL UNIQUE,         -- Номер комнаты
    room_type VARCHAR(50) NOT NULL,                  -- Тип номера (стандарт, люкс и т.д.)
    capacity INT NOT NULL,                           -- Вместимость номера
    price_per_night DECIMAL(10,2) NOT NULL,          -- Стоимость за ночь
    status ENUM('свободен', 'занят', 'на ремонте') NOT NULL DEFAULT 'свободен'  -- Статус номера
);

-- *******************************************************
-- Таблица для хранения информации о бронированиях
-- *******************************************************
CREATE TABLE IF NOT EXISTS Bookings (
    booking_id INT AUTO_INCREMENT PRIMARY KEY,      -- Уникальный идентификатор бронирования
    guest_id INT NOT NULL,                           -- Ссылка на гостя
    room_id INT NOT NULL,                            -- Ссылка на номер
    check_in_date DATE NOT NULL,                     -- Дата заезда
    check_out_date DATE NOT NULL,                    -- Дата выезда
    total_amount DECIMAL(10,2) NOT NULL,             -- Общая сумма бронирования
    payment_status ENUM('оплачено', 'ожидается') NOT NULL,  -- Статус оплаты
    FOREIGN KEY (guest_id) REFERENCES Guests(guest_id) ON DELETE CASCADE,  -- Внешний ключ на таблицу Guests
    FOREIGN KEY (room_id) REFERENCES Rooms(room_id) ON DELETE CASCADE     -- Внешний ключ на таблицу Rooms
);

-- *******************************************************
-- Таблица для хранения информации о дополнительных услугах
-- *******************************************************
CREATE TABLE IF NOT EXISTS Services (
    service_id INT AUTO_INCREMENT PRIMARY KEY,      -- Уникальный идентификатор услуги
    service_name VARCHAR(100) NOT NULL,              -- Название услуги (например, прачечная, спа)
    service_price DECIMAL(10,2) NOT NULL             -- Стоимость услуги
);

-- *******************************************************
-- Таблица для учета использования дополнительных услуг
-- *******************************************************
CREATE TABLE IF NOT EXISTS ServiceUsage (
    usage_id INT AUTO_INCREMENT PRIMARY KEY,        -- Уникальный идентификатор записи
    booking_id INT NOT NULL,                         -- Ссылка на бронирование
    service_id INT NOT NULL,                         -- Ссылка на услугу
    quantity INT NOT NULL,                           -- Количество использованных услуг
    total_cost DECIMAL(10,2) NOT NULL,               -- Общая стоимость услуги
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id) ON DELETE CASCADE,  -- Внешний ключ на таблицу Bookings
    FOREIGN KEY (service_id) REFERENCES Services(service_id) ON DELETE CASCADE   -- Внешний ключ на таблицу Services
);

-- *******************************************************
-- Таблица для учета финансовых транзакций
-- *******************************************************
CREATE TABLE IF NOT EXISTS Transactions (
    transaction_id INT AUTO_INCREMENT PRIMARY KEY,   -- Уникальный идентификатор транзакции
    booking_id INT NOT NULL,                         -- Ссылка на бронирование
    transaction_date DATE NOT NULL,                  -- Дата транзакции
    amount DECIMAL(10,2) NOT NULL,                   -- Сумма транзакции
    payment_method ENUM('карта', 'наличные', 'перевод') NOT NULL,  -- Метод оплаты
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id) ON DELETE CASCADE  -- Внешний ключ на таблицу Bookings
);

-- *******************************************************
-- Вставка тестовых данных в таблицу Guests
-- *******************************************************
INSERT INTO Guests (name, surname, patronymic, phone, email, address, passport_no)
VALUES
    ('Иван', 'Иванов', 'Иванович', '89012345678', 'ivanov@mail.com', 'Москва, ул. Пушкина, д. 10', '1234567890'),
    ('Мария', 'Петрова', 'Алексеевна', '89098765432', 'petrova@mail.com', 'Санкт-Петербург, ул. Лермонтова, д. 5', '9876543210'),
    ('Александр', 'Смирнов', 'Николаевич', '89112345678', 'alexander@mail.com', 'Екатеринбург, ул. Ленина, д. 12', '1122334455'),
    ('Елена', 'Кузнецова', 'Владимировна', '89223344556', 'elena@mail.com', 'Новосибирск, ул. Гагарина, д. 3', '6677889900'),
    ('Дмитрий', 'Васильев', 'Андреевич', '89334455667', 'dmitriy@mail.com', 'Казань, ул. Болотникова, д. 8', '2233445566'),
    ('Наталья', 'Попова', 'Александровна', '89554433444', 'popova@mail.com', 'Челябинск, ул. Красная, д. 4', '9988776655'),
    ('Сергей', 'Ковалев', 'Сергеевич', '89223345567', 'sergey@mail.com', 'Ростов-на-Дону, ул. Московская, д. 20', '6655443322'),
    ('Ирина', 'Сидорова', 'Михайловна', '89445566778', 'sidorova@mail.com', 'Уфа, ул. Советская, д. 15', '1122334455'),
    ('Алексей', 'Борисов', 'Викторович', '89554443321', 'borisov@mail.com', 'Томск, ул. Ленина, д. 10', '2233445566'),
    ('Татьяна', 'Михайлова', 'Петровна', '89123344556', 'mikhaylova@mail.com', 'Самара, ул. Пролетарская, д. 25', '5566778899');

-- *******************************************************
-- Вставка тестовых данных в таблицу Rooms
-- *******************************************************
INSERT INTO Rooms (room_number, room_type, capacity, price_per_night, status)
VALUES
    ('101', 'Стандарт', 2, 100.00, 'свободен'),
    ('102', 'Люкс', 3, 200.00, 'занят'),
    ('103', 'Стандарт', 2, 120.00, 'свободен'),
    ('104', 'Полулюкс', 2, 150.00, 'на ремонте'),
    ('105', 'Люкс', 4, 250.00, 'свободен'),
    ('106', 'Стандарт', 2, 110.00, 'свободен'),
    ('107', 'Люкс', 3, 220.00, 'занят'),
    ('108', 'Полулюкс', 2, 160.00, 'свободен'),
    ('109', 'Стандарт', 1, 80.00, 'занят'),
    ('110', 'Люкс', 4, 270.00, 'свободен');

-- *******************************************************
-- Вставка тестовых данных в таблицу Bookings
-- *******************************************************
INSERT INTO Bookings (guest_id, room_id, check_in_date, check_out_date, total_amount, payment_status)
VALUES
    (1, 1, '2024-12-01', '2024-12-05', 400.00, 'оплачено'),
    (2, 2, '2024-12-02', '2024-12-07', 1000.00, 'ожидается'),
    (3, 3, '2024-12-10', '2024-12-15', 600.00, 'оплачено'),
    (4, 4, '2024-12-05', '2024-12-10', 750.00, 'ожидается'),
    (5, 5, '2024-12-08', '2024-12-12', 1000.00, 'оплачено'),
    (6, 6, '2024-12-11', '2024-12-16', 550.00, 'ожидается'),
    (7, 7, '2024-12-12', '2024-12-17', 660.00, 'оплачено'),
    (8, 8, '2024-12-15', '2024-12-20', 800.00, 'ожидается'),
    (9, 9, '2024-12-18', '2024-12-22', 400.00, 'оплачено'),
    (10, 10, '2024-12-20', '2024-12-25', 1080.00, 'ожидается');
